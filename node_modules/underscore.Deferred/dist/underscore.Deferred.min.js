/*! underscore.Deferred - v0.1.3 - 2012-05-12
* https://github.com/wookiehangover/underscore.Deferred
* Copyright (c) 2012 Sam Breed; Licensed MIT */
(function(a){function q(a){var b=p[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var b={},c=Array.prototype,d=Object.prototype,e=d.hasOwnProperty,f=d.toString,g=c.forEach,h=c.slice,i=function(a,c,d){var f,h,i;if(!a)return;if(g&&a.forEach===g)a.forEach(c,d);else if(a.length===+a.length){for(h=0,i=a.length;h<i;h++)if(h in a&&c.call(d,a[h],h,a)===b)return}else for(f in a)if(e.call(a,f)&&c.call(d,a[f],f,a)===b)return},j=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},k=function(a){return i(h.call(arguments,1),function(b){var c;for(c in b)b[c]!==void 0&&(a[c]=b[c])}),a},l={"[object Array]":"array","[object Function]":"function"},m=function(a){return a?l[f.call(a)]||"object":String(a)},n="done fail isResolved isRejected promise then always pipe".split(" "),o={},p={};o.Callbacks=function(a){a=a?p[a]||q(a):{};var b=[],c=[],d,e,f,g,h,i,j=function(c){var d,e,f,g,h;for(d=0,e=c.length;d<e;d++)f=c[d],g=m(f),g==="array"?j(f):g==="function"&&(!a.unique||!l.has(f))&&b.push(f)},k=function(j,k){k=k||[],d=!a.memory||[j,k],e=!0,f=!0,i=g||0,g=0,h=b.length;for(;b&&i<h;i++)if(b[i].apply(j,k)===!1&&a.stopOnFalse){d=!0;break}f=!1,b&&(a.once?d===!0?l.disable():b=[]:c&&c.length&&(d=c.shift(),l.fireWith(d[0],d[1])))},l={add:function(){if(b){var a=b.length;j(arguments),f?h=b.length:d&&d!==!0&&(g=a,k(d[0],d[1]))}return this},remove:function(){if(b){var c=arguments,d=0,e=c.length;for(;d<e;d++)for(var g=0;g<b.length;g++)if(c[d]===b[g]){f&&g<=h&&(h--,g<=i&&i--),b.splice(g--,1);if(a.unique)break}}return this},has:function(a){if(b){var c=0,d=b.length;for(;c<d;c++)if(a===b[c])return!0}return!1},empty:function(){return b=[],this},disable:function(){return b=c=d=undefined,this},disabled:function(){return!b},lock:function(){return c=undefined,(!d||d===!0)&&l.disable(),this},locked:function(){return!c},fireWith:function(b,e){return c&&(f?a.once||c.push([b,e]):(!a.once||!d)&&k(b,e)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!e}};return l},o.Deferred=function(a){var b=o.Callbacks("once memory"),c=o.Callbacks("once memory"),d=o.Callbacks("memory"),e="pending",f={resolve:b,reject:c,notify:d},g={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){return h.done(a).fail(b).progress(c),this},always:function(){return h.done.apply(h,arguments).fail.apply(h,arguments),this},pipe:function(a,b,c){return o.Deferred(function(d){i({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=a[0],e=a[1],f;j(c)?h[b](function(){f=c.apply(this,arguments),f&&j(f.promise)?f.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===h?d:this,[f])}):h[b](d[e])})}).promise()},promise:function(a){if(!a)a=g;else for(var b in g)a[b]=g[b];return a}},h=g.promise({}),k;for(k in f)h[k]=f[k].fire,h[k+"With"]=f[k].fireWith;return h.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(h,h),h},o.when=function(a){function l(a){return function(c){b[a]=arguments.length>1?h.call(arguments,0):c,--f||i.resolveWith(i,b)}}function m(a){return function(b){e[a]=arguments.length>1?h.call(arguments,0):b,i.notifyWith(k,e)}}var b=h.call(arguments,0),c=0,d=b.length,e=new Array(d),f=d,g=d,i=d<=1&&a&&j(a.promise)?a:o.Deferred(),k=i.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&j(b[c].promise)?b[c].promise().then(l(c),i.reject,m(c)):--f;f||i.resolveWith(i,b)}else i!==a&&i.resolveWith(i,d?[a]:[]);return k},typeof module!="undefined"&&module.exports?module.exports=o:typeof a._!="undefined"?a._.mixin(o):a._=o})(this);