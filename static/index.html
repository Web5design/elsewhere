<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Node Social Graph</title>
    <style>
    .invalid {
      color:#CE0000;
    }
    .valid {
      color:#00C900;
    }
    </style>
    <script>

function getGraph(e) {
  var url    = document.getElementById('url'),
      strict = document.getElementById('strict'),
      submit = document.getElementById('sub'),
      strict = strict.checked ? '&strict' : '',
      url    = location.href + '?q=' + encodeURIComponent(url.value) + strict,
      xhr    = new XMLHttpRequest();

  submit.textContent = "Graphing";

  xhr.open("GET", url, true);
  xhr.onreadystatechange = function(event){
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        submit.textContent = "Graph";
        renderGraph(JSON.parse(xhr.responseText));
      } else { // fail
        console.log(xhr.statusText);
      }
    }
  };
  xhr.send(null);
}

function renderGraph(links) {
  var listElem = document.getElementById('list'),
      listHTML = "";

  links.forEach(function (link) {
    listHTML += '<li><a target="_blank" href="view-source:' + link.url + '">';
    listHTML += '<img src="' + link.favicon + '" width="16px" height="16px" />';
    listHTML += (link.title || link.url) + '</a> - ';
    listHTML += '<span class="' + (link.valid ? 'valid">valid' : 'invalid">invalid' ) + '</span></li>';
  });

  listElem.innerHTML = listHTML;
}

    </script>
  </head>
  <body>
    <h1>Node Social Graph</h1>
    <p>Type in a domain and path into the address bar e.g.</p>
    <pre>http://localhost:8888/twitter.com/ac94</pre>
    <p>The result will be returned as JSON</p>
    <p>Alternatively, enter a url below.</p>
    <ol id="list"></ol>
    <input type="text" id="url" value="lanyrd.com/profile/chrisnewtn" />
    <input type="checkbox" id="strict" checked />
    <label>strict</label>
    <button id="sub" onclick="getGraph()">Graph</button>
  </body>
</html>